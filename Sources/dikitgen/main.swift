import Foundation
import DIKit
import SourceKittenFramework
import Stencil

struct A: Injectable {
    struct Dependency {}
    init(dependency: Dependency) {}
}

struct B: Injectable {
    struct Dependency {
        let ba: A
    }
    
    init(dependency: Dependency) {}
}

struct C: Injectable {
    struct Dependency {
        let ca: A
        let cd: D
    }
    
    init(dependency: Dependency) {}
}

struct D {}

protocol DemoResolver: DIKit.Resolver {
    func provideD() -> D
}

let file = File(path: #file)!
let structure = Structure(file: file)
let resolvers = structure.substructures
    .flatMap(Type.init)
    .flatMap(Resolver.init)

let injectableNodes = structure.substructures
    .flatMap(Type.init(structure:))
    .flatMap(Node.init(injectableType:))

let context = [
    "resolvers": resolvers,
]

let template = Template(templateString: """
//
//  Resolver.swift
//  Generated by dikitgen.
//

{% for resolver in resolvers %}
extension {{ resolver.name }} {
}
{% endfor %}
""")

let rendered = try template.render(context)
print(rendered)

